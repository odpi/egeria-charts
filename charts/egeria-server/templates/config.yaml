# SPDX-License-Identifier: Apache-2.0
# Copyright Contributors to the Egeria project.
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "egeria-server.fullname" . }}-env
  labels:
    {{- include "egeria-server.labels" . | nindent 4 }}
data:
  SERVER_PORT: "{{ .Values.service.port }}"
  SERVER_SSL_ENABLED: "false"
  JAVA_APP_JAR: "{{ .Values.app.jarPath }}/{{ .Values.app.jarName }}-{{ .Chart.AppVersion }}.jar"
  LOADER_PATH: "{{ .Values.app.loaderPath }}"
  OMAG_SERVERCONFIGFILE: "file:{{ .Values.app.configPath }}/{{ .Values.app.configName }}"
  DEBUG: "false"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "egeria-server.fullname" . }}-conf
  labels:
    {{- include "egeria-server.labels" . | nindent 4 }}
data:
{{ (.Files.Glob "files/*").AsConfig | indent 2 }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "egeria-server.fullname" . }}-secret
  labels:
    {{- include "egeria-server.labels" . | nindent 4 }}
type: Opaque
data:
# Option 1: define configuration file as inline secret
  # cocoDIS1.json: ewogICJjbGFzcyI6ICJPTUFHU2VydmVyQ29uZmlnIiwKICAidmVyc2lvbklkIjogIlYyLjAiLAogICJsb2NhbFNlcnZlcklkIjogIjBhYWMzMzA4LWJhZTktNDNlOS04NzQzLTJjYWM0MzUwZmUzZiIsCiAgImxvY2FsU2VydmVyTmFtZSI6ICJjb2NvRElTMSIsCiAgImxvY2FsU2VydmVyVHlwZSI6ICJPcGVuIE1ldGFkYXRhIGFuZCBHb3Zlcm5hbmNlIFNlcnZlciIsCiAgImxvY2FsU2VydmVyVVJMIjogImh0dHBzOi8vbG9jYWxob3N0Ojk0NDQiLAogICJsb2NhbFNlcnZlclVzZXJJZCI6ICJPTUFHU2VydmVyIiwKICAibWF4UGFnZVNpemUiOiAxMDAwLAogICJyZXBvc2l0b3J5U2VydmljZXNDb25maWciOiB7CiAgICAiY2xhc3MiOiAiUmVwb3NpdG9yeVNlcnZpY2VzQ29uZmlnIiwKICAgICJhdWRpdExvZ0Nvbm5lY3Rpb25zIjogWwogICAgICB7CiAgICAgICAgImNsYXNzIjogIkNvbm5lY3Rpb24iLAogICAgICAgICJoZWFkZXJWZXJzaW9uIjogMCwKICAgICAgICAicXVhbGlmaWVkTmFtZSI6ICJTTEY0Si0gWzxVbmtub3duPiwgSW5mb3JtYXRpb24sIEV2ZW50LCBEZWNpc2lvbiwgQWN0aW9uLCBFcnJvciwgRXhjZXB0aW9uLCBTZWN1cml0eSwgU3RhcnR1cCwgU2h1dGRvd24sIEFzc2V0LCBUeXBlcywgQ29ob3J0XSIsCiAgICAgICAgImRpc3BsYXlOYW1lIjogIlNMRjRKIiwKICAgICAgICAiY29ubmVjdG9yVHlwZSI6IHsKICAgICAgICAgICJjbGFzcyI6ICJDb25uZWN0b3JUeXBlIiwKICAgICAgICAgICJxdWFsaWZpZWROYW1lIjogIkVnZXJpYTpBdWRpdExvZ0Rlc3RpbmF0aW9uQ29ubmVjdG9yOlNMRjRKIiwKICAgICAgICAgICJkaXNwbGF5TmFtZSI6ICJTTEY0SiBBdWRpdCBMb2cgRGVzdGluYXRpb24gQ29ubmVjdG9yIiwKICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJDb25uZWN0b3Igc3VwcG9ydHMgbG9nZ2luZyBvZiBhdWRpdCBsb2cgbWVzc2FnZXMgdG8gdGhlIHNsZjRqIGxvZ2dlciBlY29zeXN0ZW0uIiwKICAgICAgICAgICJjb25uZWN0b3JQcm92aWRlckNsYXNzTmFtZSI6ICJvcmcub2RwaS5vcGVubWV0YWRhdGEuYWRhcHRlcnMucmVwb3NpdG9yeXNlcnZpY2VzLmF1ZGl0bG9nc3RvcmUuc2xmNGouU0xGNEpBdWRpdExvZ1N0b3JlUHJvdmlkZXIiCiAgICAgICAgfSwKICAgICAgICAiY29uZmlndXJhdGlvblByb3BlcnRpZXMiOiB7CiAgICAgICAgICAic3VwcG9ydGVkU2V2ZXJpdGllcyI6IFsKICAgICAgICAgICAgIjxVbmtub3duPiIsCiAgICAgICAgICAgICJJbmZvcm1hdGlvbiIsCiAgICAgICAgICAgICJFdmVudCIsCiAgICAgICAgICAgICJEZWNpc2lvbiIsCiAgICAgICAgICAgICJBY3Rpb24iLAogICAgICAgICAgICAiRXJyb3IiLAogICAgICAgICAgICAiRXhjZXB0aW9uIiwKICAgICAgICAgICAgIlNlY3VyaXR5IiwKICAgICAgICAgICAgIlN0YXJ0dXAiLAogICAgICAgICAgICAiU2h1dGRvd24iLAogICAgICAgICAgICAiQXNzZXQiLAogICAgICAgICAgICAiVHlwZXMiLAogICAgICAgICAgICAiQ29ob3J0IgogICAgICAgICAgXQogICAgICAgIH0KICAgICAgfQogICAgXQogIH0sCiAgImludGVncmF0aW9uU2VydmljZXNDb25maWciOiBbCiAgICB7CiAgICAgICJjbGFzcyI6ICJJbnRlZ3JhdGlvblNlcnZpY2VDb25maWciLAogICAgICAiaW50ZWdyYXRpb25TZXJ2aWNlQ29udGV4dE1hbmFnZXJDbGFzcyI6ICJvcmcub2RwaS5vcGVubWV0YWRhdGEuaW50ZWdyYXRpb25zZXJ2aWNlcy50b3BpYy5jb250ZXh0bWFuYWdlci5Ub3BpY0ludGVncmF0b3JDb250ZXh0TWFuYWdlciIsCiAgICAgICJpbnRlZ3JhdGlvblNlcnZpY2VOYW1lIjogIkRhdGFTa29wSW50ZWdyYXRvciIsCiAgICAgICJpbnRlZ3JhdGlvblNlcnZpY2VGdWxsTmFtZSI6ICJEYXRhU2tvcEludGVncmF0b3IiLAogICAgICAiaW50ZWdyYXRpb25TZXJ2aWNlVVJMTWFya2VyIjogImRhdGEtc2tvcC1pbnRlZ3JhdG9yIiwKICAgICAgImludGVncmF0aW9uU2VydmljZURlc2NyaXB0aW9uIjogIkV4dHJhY3QgaW5mb3JtYXRpb24gZnJvbSBlZ2VyaWEgdG8gZGF0YSBza29wIiwKICAgICAgImRlZmF1bHRQZXJtaXR0ZWRTeW5jaHJvbml6YXRpb24iOiAiRlJPTV9USElSRF9QQVJUWSIsCiAgICAgICJpbnRlZ3JhdGlvbkNvbm5lY3RvckNvbmZpZ3MiOiBbCiAgICAgICAgewogICAgICAgICAgImNsYXNzIjogIkludGVncmF0aW9uQ29ubmVjdG9yQ29uZmlnIiwKICAgICAgICAgICJjb25uZWN0b3JOYW1lIjogIkRhdGFTa29wSW50ZWdyYXRvciIsCiAgICAgICAgICAidHlwZU5hbWUiOiAiRUJJIERhdGFTa29wIEludGVncmF0aW9uIENvbm5lY3RvciIsCiAgICAgICAgICAiY29ubmVjdGlvbiI6IHsKICAgICAgICAgICAgImNsYXNzIjogIkNvbm5lY3Rpb24iLAogICAgICAgICAgICAiY29ubmVjdG9yVHlwZSI6IHsKICAgICAgICAgICAgICAiY2xhc3MiOiAiQ29ubmVjdG9yVHlwZSIsCiAgICAgICAgICAgICAgImNvbm5lY3RvclByb3ZpZGVyQ2xhc3NOYW1lIjogIm9yZy5vZHBpLm9wZW5tZXRhZGF0YS5hZGFwdGVycy5jb25uZWN0b3JzLmludGVncmF0aW9uLmViaS5kYXRhc2tvcC5EYXRhU2tvcEludGVncmF0aW9uUHJvdmlkZXIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJjb25maWd1cmF0aW9uUHJvcGVydGllcyI6IHsKICAgICAgICAgICAgICAiYXV0aG9yaXNhdGlvbiI6ICJ4eHgiLAogICAgICAgICAgICAgICJwZXJmb3JtRGF0YVNrb3BQdWJsaXNoaW5nIjogInRydWUiLAogICAgICAgICAgICAgICJ4YXBpX3ZhbGlkYXRlIjogInRydWUiLAogICAgICAgICAgICAgICJ4YXBpX2NsZWFuU2NvcGUiOiAiZmFsc2UiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJlbmRwb2ludCI6IHsKICAgICAgICAgICAgICAiY2xhc3MiOiAiRW5kcG9pbnQiLAogICAgICAgICAgICAgICJhZGRyZXNzIjogInh4eCIKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgICJtZXRhZGF0YVNvdXJjZVF1YWxpZmllZE5hbWUiOiAiVGVzdE1ldGFkYXRhU291cmNlUXVhbGlmaWVkTmFtZSIsCiAgICAgICAgICAicmVmcmVzaFRpbWVJbnRlcnZhbCI6ICIxIiwKICAgICAgICAgICJwZXJtaXR0ZWRTeW5jaHJvbml6YXRpb24iOiAiVE9fVEhJUkRfUEFSVFkiCiAgICAgICAgfQogICAgICBdLAogICAgICAib21hZ3NlcnZlck5hbWUiOiAiY29jb01EUzEiLAogICAgICAib21hZ3NlcnZlclBsYXRmb3JtUm9vdFVSTCI6ICJodHRwczovL2V2ZW50LWNhdGFsb2ctcGxhdGZvcm06OTQ0MyIKICAgIH0KICBdCn0K
# Option 2: Loading files/cocoDIS1.json file as a Secret to demonstrate how this type of resource can be used to configure server via volume/mount.
{{ (.Files.Glob "files/cocoDIS1.json").AsSecrets | indent 2 }}
